name: Supabase Activity Keep Alive

on:
  schedule:
    - cron: '0 0 * * *' # Roda todo dia à meia-noite
  workflow_dispatch:

jobs:
  ping_supabase:
    runs-on: ubuntu-latest
    steps:
      - name: Auth API Health Ping
        run: |
          # Remove a barra final da URL se o usuário tiver colocado nos Secrets
          CLEAN_URL=$(echo "${{ secrets.SUPABASE_URL }}" | sed 's/\/$//')
          
          # Fazemos o ping no endpoint de saúde do módulo de Auth.
          # Este endpoint é público, seguro e registra atividade no seu projeto.
          RESPONSE=$(curl -sS -i -X GET "$CLEAN_URL/auth/v1/health")
          
          echo "--- RESPOSTA DO SISTEMA ---"
          echo "$RESPONSE"
          echo "---------------------------"

          # Verifica se o servidor respondeu 200 OK
          if echo "$RESPONSE" | grep -q "HTTP/.* 200"; then
            echo "✅ Projeto ativo. Atividade de API registrada no Supabase."
          else
            echo "❌ Falha ao contatar o serviço de Health."
            exit 1
          fi
