name: Supabase Activity Keep Alive

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  ping_db:
    runs-on: ubuntu-latest
    steps:
      - name: Health Check Ping
        run: |
          # Consultamos apenas a tabela de health_check
          RESPONSE=$(curl -sS -i -X GET "${{ secrets.SUPABASE_URL }}/rest/v1/health_check?select=id" \
            -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}")
          
          # Verifica se a resposta foi 200 OK
          if echo "$RESPONSE" | grep -q "HTTP/1.1 200 OK" || echo "$RESPONSE" | grep -q "HTTP/2 200"; then
            echo "✅ Atividade registrada com sucesso na tabela health_check."
          else
            echo "❌ Falha no Ping. Verifique os logs abaixo:"
            echo "$RESPONSE"
            exit 1
          fi
